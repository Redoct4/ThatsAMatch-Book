<html>
Â  <head>
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  Â  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
Â  Â  <style>
Â  Â  Â  /* ... (Estilos CSS sin cambios) ... */
Â  Â  Â  #start-button-container {
Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  display: flex; justify-content: center; align-items: center;
Â  Â  Â  Â  background-color: black; z-index: 9999;
Â  Â  Â  }
Â  Â  Â  #start-button {
Â  Â  Â  Â  padding: 15px 30px; font-size: 1.2em; cursor: pointer;
Â  Â  Â  }
Â  Â  Â  #my-scene {
Â  Â  Â  Â  visibility: hidden;
Â  Â  Â  }
Â  Â  </style>

Â  Â  Â  Â  <script>
      AFRAME.registerComponent('ar-video-handler', {
        schema: {
          videoId: {type: 'string'}, // ID del video a reproducir (ej: 'video-0')
          targetIndex: {type: 'number'} // Ãndice del target (ej: 0)
        },
        init: function () {
          const videoAsset = document.querySelector(`#${this.data.videoId}`);
          const targetEntity = this.el;

          // Evento al detectar el target
          targetEntity.addEventListener('targetFound', () => {
            console.log(`Target ${this.data.targetIndex} encontrado. Reproduciendo ${this.data.videoId}`);
            // Reproducir y reintentar si es necesario
            videoAsset.play().catch(error => {
              console.error(`Error de reproducciÃ³n en video ${this.data.videoId}:`, error);
            });
          });

          // Evento al perder el target
          targetEntity.addEventListener('targetLost', () => {
            console.log(`Target ${this.data.targetIndex} perdido. Pausando ${this.data.videoId}`);
            videoAsset.pause();
            videoAsset.currentTime = 0; // Reiniciar para que empiece de nuevo
          });
        }
      });
    </script>
Â  </head>
Â  <body>
Â  Â Â 
Â  Â  <div id="start-button-container">
Â  Â  Â  <button id="start-button">TOCA PARA INICIAR LA RA</button>
Â  Â  </div>
Â  Â Â 

Â  Â  <a-scene id="my-scene" mindar-image="imageTargetSrc: ./targets.mind;"Â 
Â  Â  Â  Â  Â  Â  Â  color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights"Â 
Â  Â  Â  Â  Â  Â  Â  vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
Â  Â  Â Â 
Â  Â  Â  <a-assets>
Â  Â  Â  Â  Â  Â  Â  Â  <video id="video-0" src="./video-0.webm" loop playsinline crossorigin="anonymous" muted></video>
Â  Â  Â  Â  <video id="video-1" src="./video-1.webm" loop playsinline crossorigin="anonymous" muted></video>
Â  Â  Â  Â  <video id="video-2" src="./video-2.webm" loop playsinline crossorigin="anonymous" muted></video>
Â  Â  Â  Â  <video id="video-3" src="./video-3.webm" loop playsinline crossorigin="anonymous" muted></video>
Â  Â  Â  Â  <video id="video-4" src="./video-4.webm" loop playsinline crossorigin="anonymous" muted></video>
Â  Â  Â  </a-assets>

Â  Â  Â  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <a-entity mindar-image-target="targetIndex: 0" ar-video-handler="videoId: video-0; targetIndex: 0">
Â  Â  Â  Â  <a-plane src="#video-0" position="0 0 0" height="2" width="1.281" rotation="0 0 0"></a-plane>
Â  Â  Â  </a-entity>

Â  Â  Â  Â  Â  Â  <a-entity mindar-image-target="targetIndex: 1" ar-video-handler="videoId: video-1; targetIndex: 1">
Â  Â  Â  Â  <a-plane src="#video-1" position="0 0 0" height="2" width="1.281" rotation="0 0 0"></a-plane>
Â  Â  Â  </a-entity>

Â  Â  Â  Â  Â  Â  <a-entity mindar-image-target="targetIndex: 2" ar-video-handler="videoId: video-2; targetIndex: 2">
Â  Â  Â  Â  <a-plane src="#video-2" position="0 0 0" height="2" width="1.281" rotation="0 0 0"></a-plane>
Â  Â  Â  </a-entity>

Â  Â  Â  Â  Â  Â  <a-entity mindar-image-target="targetIndex: 3" ar-video-handler="videoId: video-3; targetIndex: 3">
Â  Â  Â  Â  <a-plane src="#video-3" position="0 0 0" height="2" width="1.281" rotation="0 0 0"></a-plane>
Â  Â  Â  </a-entity>

Â  Â  Â  Â  Â  Â  <a-entity mindar-image-target="targetIndex: 4" ar-video-handler="videoId: video-4; targetIndex: 4">
Â  Â  Â  Â  <a-plane src="#video-4" position="0 0 0" height="2" width="1.281" rotation="0 0 0"></a-plane>
Â  Â  Â  </a-entity>
Â  Â  </a-scene>
Â  </body>

Â  <script>
Â  Â  // LÃ³gica para el botÃ³n de inicio (modificada para manejar mÃºltiples videos)
Â  Â  document.getElementById('start-button').addEventListener('click', () => {
Â  Â  Â  const scene = document.getElementById('my-scene');
Â  Â  Â  const container = document.getElementById('start-button-container');
Â  Â  Â Â 
Â  Â  Â  container.style.display = 'none';
Â  Â  Â  scene.style.visibility = 'visible';

      // ðŸ’¡ CLAVE: Iterar sobre todos los videos para forzar el desbloqueo
      const videoAssets = document.querySelectorAll('video');

      // Usamos Promise.all para asegurarnos de que todos los videos se intenten reproducir
      Promise.all(Array.from(videoAssets).map(video => 
        video.play().catch(e => console.warn(`Error al desbloquear video ${video.id}:`, e))
      )).then(() => {
        // Una vez desbloqueados, pausamos todos para que esperen al target
        videoAssets.forEach(video => {
          video.pause();
          video.currentTime = 0;
        });
        console.log("Todos los videos han sido desbloqueados y pausados.");
      });
Â  Â  });
Â  </script>
</html>
